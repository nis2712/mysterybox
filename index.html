<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Fun Surprise Box</title>
<style>
  body{
    margin:0;
    font-family:'Comic Sans MS', Arial, sans-serif;
    background:linear-gradient(135deg,#74ebd5,#acb6e5);
    text-align:center;
    overflow:hidden;
  }
  h1{ margin:18px 0 10px; color:white; text-shadow:2px 2px 6px rgba(0,0,0,.25); }

  .topbar{
    display:flex;
    justify-content:center;
    gap:10px;
    flex-wrap:wrap;
    padding:8px 12px;
  }

  .mode-btn{
    padding:10px 18px;
    border:none;
    border-radius:18px;
    font-size:16px;
    font-weight:900;
    cursor:pointer;
    color:white;
    box-shadow:0 6px 14px rgba(0,0,0,.18);
    transition:.15s transform;
  }
  .mode-btn:hover{ transform:scale(1.03); }
  .mode-btn.active{ outline:3px solid rgba(255,255,255,.7); }

  .hemat{ background:#2ecc71; }
  .royal{ background:#3498db; }
  .tajir{ background:#e84393; }

  .ctrl-btn{
    padding:10px 16px;
    border:none;
    border-radius:18px;
    font-size:15px;
    font-weight:900;
    cursor:pointer;
    background:#ff7675;
    color:white;
    box-shadow:0 6px 14px rgba(0,0,0,.18);
    transition:.15s transform;
  }
  .ctrl-btn:hover{ transform:scale(1.03); }
  .ctrl-btn:disabled{ opacity:.55; cursor:not-allowed; transform:none; }

  .grid{
    display:grid;
    grid-template-columns:repeat(5,110px);
    gap:14px;
    justify-content:center;
    padding:18px 12px 28px;
  }

  .box{
    background:white;
    border-radius:22px;
    padding:16px 10px;
    cursor:pointer;
    box-shadow:0 8px 18px rgba(0,0,0,.18);
    transition:.18s transform, .18s filter;
    position:relative;
    min-height:86px;
  }
  .box:hover{ transform:translateY(-2px) scale(1.02); filter:brightness(1.02); }
  .box.disabled{ cursor:not-allowed; }
  .box.disabled:hover{ transform:none; filter:none; }

  .num{
    font-size:20px;
    font-weight:1000;
    color:#2d3436;
  }

  .gift{
    margin-top:10px;
    font-size:14px;
    font-weight:900;
    color:#2d3436;
    display:none;
    line-height:1.1;
  }

  /* reveal state */
  .box.revealed{
    background:#ffeaa7;
  }
  .box.revealed .gift{
    display:block;
    animation:popText .22s ease forwards;
    opacity:0;
    transform:translateY(6px);
  }
  @keyframes popText{
    to{ opacity:1; transform:translateY(0); }
  }

  .box.picked{
    outline:4px solid rgba(255,215,0,.85);
    box-shadow:0 10px 22px rgba(0,0,0,.22), 0 0 0 6px rgba(255,215,0,.18);
  }
  .tag{
    position:absolute;
    top:10px; right:10px;
    background:rgba(255,215,0,.95);
    color:#2d3436;
    font-weight:1000;
    font-size:11px;
    padding:4px 8px;
    border-radius:999px;
    display:none;
  }
  .box.picked .tag{ display:block; }

  /* POPUP */
  .popup{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.45);
    display:none;
    justify-content:center;
    align-items:center;
    padding:16px;
  }
  .popup-content{
    background:white;
    padding:26px 22px;
    border-radius:26px;
    max-width:520px;
    width:100%;
    box-shadow:0 18px 40px rgba(0,0,0,.35);
    animation:pop .35s ease;
  }
  @keyframes pop{
    0%{ transform:scale(0.7); opacity:0; }
    100%{ transform:scale(1); opacity:1; }
  }
  .popup h2{
    margin:0 0 10px;
    color:#ff7675;
    font-size:28px;
  }
  .popup p{
    margin:10px 0 0;
    font-size:22px;
    font-weight:1000;
    color:#2d3436;
  }
  .close-btn{
    margin-top:16px;
    padding:10px 18px;
    border:none;
    border-radius:18px;
    font-size:16px;
    font-weight:1000;
    cursor:pointer;
    background:#55efc4;
    color:#2d3436;
  }

  .note{
    color:white;
    font-weight:900;
    text-shadow:2px 2px 6px rgba(0,0,0,.18);
    margin-bottom:4px;
  }
</style>
</head>
<body>

<h1>üéÅ FUN SURPRISE BOX üéÅ</h1>
<div class="note" id="modeNote">Mode: HEMAT (1R)</div>

<div class="topbar">
  <button class="mode-btn hemat active" data-mode="hemat">HEMAT</button>
  <button class="mode-btn royal" data-mode="royal">ROYAL</button>
  <button class="mode-btn tajir" data-mode="tajir">TAJIR</button>

  <button class="ctrl-btn" id="resetBtn">Reset</button>
  <button class="ctrl-btn" id="shuffleBtn">Shuffle</button>
</div>

<div class="grid" id="grid"></div>

<div class="popup" id="popup">
  <div class="popup-content">
    <h2>üéâ CONGRATS! üéâ</h2>
    <p id="prizeText"></p>
    <button class="close-btn" onclick="closePopup()">OK</button>
  </div>
</div>

<script>
  // ====== EDIT HADIAH DI SINI (WAJIB 15 ITEM PER MODE) ======
  const POOL = {
    hemat: [
      "Coin 50","Coin 75","Candy","Sticker Pack","Coin 100",
      "Mini Toy","Lucky Star","Small Boost","Mystery Gift","Badge",
      "Treasure Mini","Sparkle Wand","Token x2","Gift Pack","Bonus"
    ],
    royal: [
      "Coin 300","Coin 400","Rare Candy","Gem 10","Royal Pack",
      "Coin 500","Key x2","Boost 30m","Token x2","Lucky Spin",
      "Gem 15","Big Pack","Coin 600","Surprise Box","Special Bonus"
    ],
    tajir: [
      "Coin 1000","Gem 30","Epic Token","Epic Pack","Coin 1500",
      "Gem 40","Key x5","Boost 2h","Token x3","Ultra Pack",
      "Coin 2000","Gem 50","SECRET PRIZE","Jackpot","Mega Box"
    ]
  };
  // ==========================================================

  const PRICE = { hemat:"1R", royal:"5R", tajir:"10R" };

  const grid = document.getElementById("grid");
  const popup = document.getElementById("popup");
  const prizeText = document.getElementById("prizeText");
  const modeNote = document.getElementById("modeNote");

  const modeBtns = document.querySelectorAll(".mode-btn");
  const resetBtn = document.getElementById("resetBtn");
  const shuffleBtn = document.getElementById("shuffleBtn");

  let mode = "hemat";
  let gifts = [];
  let pickedIndex = null;

  // untuk reveal bertahap
  let revealStep = 0;          // 0..15
  let revealTimer = null;
  let isRevealing = false;

  // ====== atur kecepatan reveal di sini ======
  const REVEAL_DELAY_MS = 120; // makin kecil makin cepat
  // ===========================================

  function fisherYatesShuffle(arr){
    for(let i=arr.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [arr[i],arr[j]] = [arr[j],arr[i]];
    }
    return arr;
  }

  function resetRound(){
    stopReveal();
    gifts = fisherYatesShuffle([...POOL[mode]]);
    pickedIndex = null;
    revealStep = 0;
    isRevealing = false;
    render();
    enableControls(true);
  }

  function shuffleOnly(){
    if(isRevealing || pickedIndex !== null) return; // jangan ubah saat proses/reveal
    gifts = fisherYatesShuffle(gifts);
    render();
  }

  function setMode(newMode){
    mode = newMode;
    modeBtns.forEach(b => b.classList.toggle("active", b.dataset.mode === newMode));
    modeNote.textContent = `Mode: ${newMode.toUpperCase()} (${PRICE[newMode]})`;
    resetRound();
  }

  function pick(i){
    if(pickedIndex !== null || isRevealing) return; // lock
    pickedIndex = i;
    isRevealing = true;
    revealStep = 0;

    // disable kontrol biar ga ke-reset / shuffle saat animasi
    enableControls(false);

    // mulai reveal bertahap 1..15
    revealTimer = setInterval(() => {
      revealStep++;
      render();

      if(revealStep >= 15){
        stopReveal();
        // setelah semua kebuka, baru popup hadiah terpilih
        setTimeout(() => {
          prizeText.textContent = `You got: ${gifts[pickedIndex]} üéÅ`;
          popup.style.display = "flex";
          enableControls(true); // boleh reset untuk ronde berikutnya
        }, 250);
      }
    }, REVEAL_DELAY_MS);
  }

  function stopReveal(){
    if(revealTimer){
      clearInterval(revealTimer);
      revealTimer = null;
    }
    isRevealing = false;
  }

  function enableControls(enabled){
    resetBtn.disabled = !enabled;
    shuffleBtn.disabled = !enabled;
    modeBtns.forEach(b => b.disabled = !enabled);
  }

  function render(){
    grid.innerHTML = "";
    for(let i=0;i<15;i++){
      const div = document.createElement("div");
      div.className = "box";

      const shouldReveal = (i < revealStep); // buka bertahap dari 1 ke 15
      if(shouldReveal) div.classList.add("revealed");
      if(pickedIndex === i) div.classList.add("picked");
      if(isRevealing) div.classList.add("disabled");

      div.innerHTML = `
        <div class="tag">PICK</div>
        <div class="num">${i+1}</div>
        <div class="gift">${shouldReveal ? escapeHtml(gifts[i]) : ""}</div>
      `;

      div.onclick = () => pick(i);
      grid.appendChild(div);
    }
  }

  function escapeHtml(str){
    return String(str)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  function closePopup(){
    popup.style.display = "none";
  }

  popup.addEventListener("click", (e) => {
    if(e.target === popup) closePopup();
  });

  modeBtns.forEach(btn => btn.addEventListener("click", () => setMode(btn.dataset.mode)));
  resetBtn.addEventListener("click", resetRound);
  shuffleBtn.addEventListener("click", shuffleOnly);

  resetRound();
</script>

</body>
</html>
